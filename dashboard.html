<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Total USDTüí≤- Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@twa-dev/sdk@7.10.1/dist/telegram-web-apps.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f0c1a 0%, #1a1333 100%);
      color: white;
      min-height: 100vh;
      padding: 1rem;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 1.5rem 0;
      border-bottom: 2px solid rgba(185, 246, 202, 0.2);
      margin-bottom: 2rem;
    }

    .header h1 {
      font-size: 2rem;
      background: linear-gradient(90deg, #b9f6ca, #ffea00, #e040fb);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
    }

    .user-info {
      color: #b9f6ca;
      font-size: 1rem;
    }

    .balance-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .balance-card {
      background: linear-gradient(135deg, rgba(185, 246, 202, 0.1) 0%, rgba(224, 64, 251, 0.1) 100%);
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid rgba(185, 246, 202, 0.2);
      text-align: center;
      transition: transform 0.3s ease;
    }

    .balance-card:hover {
      transform: translateY(-5px);
      border-color: rgba(224, 64, 251, 0.5);
    }

    .balance-label {
      font-size: 0.9rem;
      color: #b9f6ca;
      margin-bottom: 0.5rem;
    }

    .balance-value {
      font-size: 2rem;
      font-weight: bold;
      background: linear-gradient(90deg, #ffea00, #b9f6ca);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .section {
      background: rgba(30, 25, 50, 0.6);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(185, 246, 202, 0.15);
    }

    .section-title {
      font-size: 1.3rem;
      color: #ffea00;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .task-item {
      background: rgba(20, 15, 35, 0.6);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.8rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid rgba(185, 246, 202, 0.1);
    }

    .task-info {
      flex: 1;
    }

    .task-title {
      font-size: 1rem;
      margin-bottom: 0.3rem;
    }

    .task-reward {
      color: #b9f6ca;
      font-size: 0.9rem;
    }

    .btn {
      background: linear-gradient(90deg, #00c853, #ffea00);
      color: #0d0a1a;
      border: none;
      padding: 0.6rem 1.5rem;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(185, 246, 202, 0.6);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: linear-gradient(90deg, #e040fb, #b9f6ca);
    }

    .referral-box {
      background: rgba(224, 64, 251, 0.1);
      border: 1px dashed #e040fb;
      border-radius: 12px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .referral-link {
      background: rgba(20, 15, 35, 0.8);
      padding: 0.8rem;
      border-radius: 8px;
      word-break: break-all;
      font-size: 0.85rem;
      color: #b9f6ca;
      margin: 0.5rem 0;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.8rem;
    }

    .stat-item {
      background: rgba(20, 15, 35, 0.6);
      padding: 1rem;
      border-radius: 10px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      color: #ffea00;
      font-weight: bold;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #b9f6ca;
      margin-top: 0.3rem;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      color: #b9f6ca;
    }

    .error {
      background: rgba(255, 0, 0, 0.2);
      border: 1px solid rgba(255, 0, 0, 0.5);
      padding: 1rem;
      border-radius: 8px;
      color: #ff6b6b;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Total USDT üí≤</h1>
      <div class="user-info" id="user-name">Loading...</div>
    </div>

    <div id="loading" class="loading">
      <p>Loading your dashboard...</p>
    </div>

    <div id="error" class="error" style="display: none;"></div>

    <div id="dashboard" style="display: none;">
      <!-- Balance Cards -->
      <div class="balance-cards">
        <div class="balance-card">
          <div class="balance-label">üíé Points</div>
          <div class="balance-value" id="points">0</div>
        </div>
        <div class="balance-card">
          <div class="balance-label">üí∞ USDT</div>
          <div class="balance-value" id="usdt">0.00</div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="section">
        <div class="section-title">üìä Your Stats</div>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value" id="total-earned">100</div>
            <div class="stat-label">Total Earned</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="referrals">0</div>
            <div class="stat-label">Referrals</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="tasks-completed">1</div>
            <div class="stat-label">Tasks Done</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="level">1</div>
            <div class="stat-label">Level</div>
          </div>
        </div>
      </div>

      <!-- Earn More Section -->
      <div class="section">
        <div class="section-title">üéØ Earn More Points</div>
        
        <div class="task-item">
          <div class="task-info">
            <div class="task-title">Watch Ads</div>
            <div class="task-reward">+10 points per ad</div>
          </div>
          <button class="btn" onclick="watchAds()">Watch</button>
        </div>

        <div class="task-item">
          <div class="task-info">
            <div class="task-title">Daily Check-in</div>
            <div class="task-reward">+5 points</div>
          </div>
          <button class="btn" onclick="claimDaily()">Claim</button>
        </div>

        <div class="task-item">
          <div class="task-info">
            <div class="task-title">Join Our Channel</div>
            <div class="task-reward">+10 points</div>
          </div>
          <button class="btn" onclick="joinChannel()">Join</button>
        </div>

        <div class="task-item">
          <div class="task-info">
            <div class="task-title">Refer a Friend</div>
            <div class="task-reward">+50 points</div>
          </div>
          <button class="btn btn-secondary" onclick="shareReferral()">Share</button>
        </div>
      </div>

      <!-- Referral Section -->
      <div class="section">
        <div class="section-title">üéÅ Invite Friends</div>
        <p style="margin-bottom: 1rem; color: #e0e0ff;">Share your referral link and earn 50 points for each friend!</p>
        <div class="referral-box">
          <div class="referral-link" id="referral-link">Loading...</div>
          <button class="btn" onclick="copyReferral()" style="width: 100%; margin-top: 0.5rem;">üìã Copy Link</button>
        </div>
      </div>

      <!-- Withdrawal Section -->
      <div class="section">
        <div class="section-title">üí∏ Withdraw</div>
        <p style="margin-bottom: 1rem; color: #e0e0ff;">Convert your points to USDT (1000 points = 1 USDT)</p>
        <button class="btn" onclick="withdraw()" style="width: 100%;" disabled>Withdraw USDT (Coming Soon)</button>
      </div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    let userData = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      if (tg) {
        tg.ready();
        tg.expand();
      }

      await loadUserData();
    });

    // Load user data
    async function loadUserData() {
      try {
        if (!tg || !tg.initDataUnsafe?.user) {
          showError('Please open this app from Telegram');
          return;
        }

        const user = tg.initDataUnsafe.user;
        userData = user;

        // Update user name
        document.getElementById('user-name').textContent = 
          `Welcome, ${user.first_name || user.username || 'User'}! üëã`;

        // Fetch user stats from worker
        const response = await fetch('https://tusdt-worker.macrotiser-pk.workers.dev/user/stats', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            telegram_id: user.id
          })
        });

        const data = await response.json();

        if (data.success) {
          // Update balance
          document.getElementById('points').textContent = data.points || 0;
          document.getElementById('usdt').textContent = (data.usdt_balance || 0).toFixed(2);

          // Update referral link
          const referralLink = `https://t.me/totalusdtbot/tusdt?start=${user.id}`;
          document.getElementById('referral-link').textContent = referralLink;

          // Show dashboard
          document.getElementById('loading').style.display = 'none';
          document.getElementById('dashboard').style.display = 'block';
        } else {
          showError('Failed to load user data. Please try again.');
        }
      } catch (error) {
        console.error('Error loading data:', error);
        showError('Network error. Please check your connection.');
      }
    }

    // Daily claim
    function claimDaily() {
      tg.showAlert('Daily check-in claimed! +5 points üéâ');
      // TODO: Implement actual claim logic with worker
    }

    // Join channel
    function joinChannel() {
      tg.openTelegramLink('https://t.me/totalusdt');
    }

    // Share referral
    function shareReferral() {
      const referralLink = document.getElementById('referral-link').textContent;
      const text = `Join Total USDT and earn real USDT! üí∞\n\nUse my referral link:\n${referralLink}`;
      tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(text)}`);
    }

    // Copy referral
    function copyReferral() {
      const referralLink = document.getElementById('referral-link').textContent;
      navigator.clipboard.writeText(referralLink).then(() => {
        tg.showAlert('Referral link copied! üìã');
      }).catch(() => {
        tg.showAlert('Failed to copy. Please copy manually.');
      });
    }

    // Withdraw
    function withdraw() {
      tg.showAlert('Withdrawal feature coming soon! üöÄ');
    }

    // Show error
    function showError(message) {
      document.getElementById('loading').style.display = 'none';
      document.getElementById('error').style.display = 'block';
      document.getElementById('error').textContent = message;
    }
  </script>
</body>
</html>