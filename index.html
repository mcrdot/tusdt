<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Earn USDT effortlessly inside Telegram. Pre-register now for early access & bonus rewards.">
  <title>Total USDT 💲</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Background particles -->
  <canvas id="bg-particles"></canvas>

  <!-- Main content (hidden by default until Telegram is confirmed) -->
  <div id="intro" style="display: none;">
    <section class="page" id="page1">
      <h1>Total USDT 💲</h1>
      <p>Earn USDT effortlessly while enjoying Telegram.</p>
      <button class="scroll-btn" data-next="2">Next</button>
    </section>

    <section class="page" style="display: none;" id="page2">
      <h2>🎯 Mission</h2>
      <p>Empowering Telegram users globally to earn rewards through fun, engagement, and opportunities.</p>
      <button class="scroll-btn" data-next="3">Next</button>
    </section>

    <section class="page" style="display: none;" id="page3">
      <h2>💰 How It Works</h2>
      <div class="cards">
        <div class="card">
          <h3>Earn Points</h3>
          <p>Join challenges, games, and tasks to earn points daily.</p>
        </div>
        <div class="card">
          <h3>Convert to USDT</h3>
          <p>Redeem your points securely into your USDT wallet.</p>
        </div>
        <div class="card">
          <h3>Instant Rewards</h3>
          <p>Withdraw anytime, anywhere — no waiting, no limits!</p>
        </div>
      </div>
      <button class="scroll-btn" data-next="4">Next</button>
    </section>

    <section class="page" style="display: none;" id="page4">
      <h2>🚀 Join the Future of Earning</h2>
      <p>Pre-register now to secure your early access and bonus rewards.</p>
      <form id="enroll-form">
        <input type="email" id="email" placeholder="Your email (for updates)" required>
        <button type="submit">Pre-Enroll Now</button>
      </form>
      <p id="status"></p>
    </section>
  </div>

  <!-- Shown ONLY if NOT in Telegram -->
  <div id="outside-telegram" style="display: none; text-align: center; padding: 2rem; background: rgba(15,12,26,0.9); border-radius: 16px; max-width: 500px; margin: 2rem auto; border: 1px solid rgba(224,64,251,0.3);">
    <h2>✨ Welcome, Future Earner!</h2>
    <p>Total USDT works inside <strong>Telegram</strong>.</p>
    <p>Open this link in Telegram to join:</p>
    <p><strong>@TotalUSDTbot</strong></p>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=https://t.me/TotalUSDTbot" alt="QR to TotalUSDTbot" style="width:180px; margin:1rem 0;">
    <p>Or tap the link above on your phone!</p>
  </div>

  <!-- Load Telegram script first -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="particles.js"></script>

<script>
  // Wait a heartbeat for everything to load
  setTimeout(() => {
    // 🔥 Bulletproof Telegram detection
    const urlParams = new URLSearchParams(window.location.search);
    const isInTelegram = (
      typeof window.Telegram !== 'undefined' ||
      urlParams.has('tgWebAppData') ||
      window.location.href.includes('tgWebApp')
    );

    if (isInTelegram) {
      // Hide outside view, show main content
      document.getElementById('outside-telegram')?.style.setProperty('display', 'none', 'important');
      document.getElementById('intro').style.display = 'block';
      
      // Initialize Telegram WebApp
      const tg = window.Telegram?.WebApp || {};
      if (tg.initData) {
        tg.expand?.();
        tg.ready?.();
      }

      // Show first page
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      document.getElementById('page1').style.display = 'block';

      // Form & navigation (same as before)
      document.getElementById('enroll-form')?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        const statusEl = document.getElementById('status');
        statusEl.textContent = 'Registering...';
        statusEl.style.color = '#37aee2';

        try {
          const response = await fetch('https://tusdt-worker.macrotiser-pk.workers.dev/auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              ...(tg.initDataUnsafe?.user || {}),
              email: email
            })
          });

          const result = await response.json();
          statusEl.textContent = result.success 
            ? '✅ Success! You’re pre-registered. Early access coming soon!' 
            : '⚠️ ' + (result.error || 'Something went wrong.');
          statusEl.style.color = result.success ? 'green' : 'orange';
          if (result.success) document.querySelector('#enroll-form button').disabled = true;
        } catch {
          statusEl.textContent = '❌ Network error. Please try again.';
          statusEl.style.color = 'red';
        }
      });

      document.querySelectorAll('.scroll-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const next = btn.dataset.next;
          document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
          document.getElementById(`page${next}`)?.style.display = 'block';
        });
      });

    } else {
      // Definitely outside Telegram → show QR
      document.getElementById('intro').style.display = 'none';
      document.getElementById('outside-telegram').style.display = 'block';
      document.body.style.backgroundColor = '#0f0c1a';
    }
  }, 150);
</script>
</body>
</html>