<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Earn USDT effortlessly inside Telegram. Pre-register now for early access & bonus rewards.">
  <title>Total USDT 💲</title>
  <link rel="stylesheet" href="style.css">
  <style>
    #outside-telegram {
      display: none;
      text-align: center;
      padding: 2rem;
      background: #f8f9fa;
      border-radius: 12px;
      max-width: 500px;
      margin: 2rem auto;
    }
    #outside-telegram img {
      width: 180px;
      margin: 1rem 0;
    }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <!-- Background particles -->
  <canvas id="bg-particles"></canvas>

  <!-- Main content (only shown inside Telegram) -->
  <div id="intro" class="hidden">
    <section class="page" id="page1">
      <h1>Total USDT 💲</h1>
      <p>Earn USDT effortlessly while enjoying Telegram.</p>
      <button class="scroll-btn" data-next="2">Next</button>
    </section>

    <section class="page hidden" id="page2">
      <h2>🎯 Mission</h2>
      <p>Empowering Telegram users globally to earn rewards through fun, engagement, and opportunities.</p>
      <button class="scroll-btn" data-next="3">Next</button>
    </section>

    <section class="page hidden" id="page3">
      <h2>💰 How It Works</h2>
      <div class="cards">
        <div class="card">
          <h3>Earn Points</h3>
          <p>Join challenges, games, and tasks to earn points daily.</p>
        </div>
        <div class="card">
          <h3>Convert to USDT</h3>
          <p>Redeem your points securely into your USDT wallet.</p>
        </div>
        <div class="card">
          <h3>Instant Rewards</h3>
          <p>Withdraw anytime, anywhere — no waiting, no limits!</p>
        </div>
      </div>
      <button class="scroll-btn" data-next="4">Next</button>
    </section>

    <section class="page hidden" id="page4">
      <h2>🚀 Join the Future of Earning</h2>
      <p>Pre-register now to secure your early access and bonus rewards.</p>
      <form id="enroll-form">
        <input type="email" id="email" placeholder="Your email (for updates)" required>
        <button type="submit">Pre-Enroll Now</button>
      </form>
      <p id="status"></p>
    </section>
  </div>

  <!-- Shown ONLY if NOT in Telegram -->
  <div id="outside-telegram">
    <h2>✨ Welcome, Future Earner!</h2>
    <p>Total USDT works inside <strong>Telegram</strong>.</p>
    <p>Open this link in Telegram to join:</p>
    <p><strong>@TotalUSDTbot</strong></p>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=https://t.me/TotalUSDTbot" alt="QR to TotalUSDTbot">
    <p>Or tap the link above on your phone!</p>
  </div>

  <!-- Telegram WebApp script -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    // Detect if inside Telegram
    const isInTelegram = typeof window.Telegram !== 'undefined' && window.Telegram.WebApp;

    if (isInTelegram) {
      // Show main content
      document.getElementById('intro').classList.remove('hidden');
      const tg = window.Telegram.WebApp;
      tg.expand(); // Use full height
      tg.ready();   // Signal readiness

      // Handle form submission
      document.getElementById('enroll-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        const statusEl = document.getElementById('status');
        statusEl.textContent = 'Registering...';
        statusEl.style.color = '#37aee2';

        try {
          // Send to your Cloudflare Worker
          const response = await fetch('https://tusdt-worker.macrotiser-pk.workers.dev/auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              ...tg.initDataUnsafe.user, // telegram_id, username, first_name, etc.
              email: email
            })
          });

          const result = await response.json();
          if (result.success) {
            statusEl.textContent = '✅ Success! You’re pre-registered. Early access coming soon!';
            statusEl.style.color = 'green';
            // Optional: disable form
            document.getElementById('enroll-form').querySelector('button').disabled = true;
          } else {
            statusEl.textContent = '⚠️ ' + (result.error || 'Something went wrong.');
            statusEl.style.color = 'orange';
          }
        } catch (err) {
          statusEl.textContent = '❌ Network error. Please try again.';
          statusEl.style.color = 'red';
        }
      });

      // Simple page navigation (you can enhance later)
      document.querySelectorAll('.scroll-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const next = btn.dataset.next;
          document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
          document.getElementById(`page${next}`).classList.remove('hidden');
        });
      });

    } else {
      // Not in Telegram → show bot prompt
      document.getElementById('outside-telegram').style.display = 'block';
      document.body.style.backgroundColor = '#ffffff';
    }
  </script>
</body>
</html>